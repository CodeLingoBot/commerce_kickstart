<?php

/**
 * Implements hook_menu().
 */
function demo_menu() {
  $items = array();
  $items['admin/demo'] = array(
    'title' => 'Manage demo',
    'description' => 'todo.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('demo_kill_me_form'),
    'access callback' => TRUE,
    //'access callback' => 'commerce_product_ui_product_add_any_access',
    'weight' => 10,
  );
  return $items;
}

/**
 * Menu callback.
 */
function demo_kill_me_form() {
  $form['buttons']['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Kill me !'),
  );
  return $form;
}

/**
 * Submit function for .
 *
 * @param $form
 * @param $form_state
 */
function  demo_kill_me_form_submit($form, &$form_state) {
  global $databases, $db_url;
  $database = $databases['default']['default'];
  $tables = db_find_tables('%');

  foreach($tables as $table) {
    db_drop_table($table);
  }
  include_once DRUPAL_ROOT . '/includes/install.inc';
  install_goto('install.php?profile=commerce_kickstart&locale=en');

}

/**
 * Implements hook_page_alter().
 */
function demo_page_alter(&$page) {
  global $base_url, $base_path;
  $message = 'Demo mode enable. You can delete everything you create in this mode by clicking on this message. If you want to keep them, disable the demo module.';
  $url = 'admin/demo';
  $icon_path = $base_url . $base_path . drupal_get_path('module', 'demo') . '/images/';
  $js = '
      <script type="text/javascript">
        var DEMO_OPTIONS = {
          icons_path: "' . $icon_path . '",
          message: "' . filter_xss_admin($message) . '",
          url: "' . $url . '"
        }
      </script>
      <script type="text/javascript" src="' . $base_url . $base_path . drupal_get_path('module', 'demo') . '/demo.js' . '"></script>
  ';
  if ($message) {
    $page['page_bottom']['demo'] = array(
      '#type' => 'markup',
      '#markup' => $js,
    );
  }
}

