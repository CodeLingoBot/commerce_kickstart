<?php

/**
 * Implements hook_menu().
 */
function demo_menu() {
  $items = array();
  $items['admin/demo'] = array(
    'title' => 'Manage demo',
    'description' => 'todo.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('demo_kill_me_form'),
    'access callback' => TRUE,
    //'access callback' => 'commerce_product_ui_product_add_any_access',
    'weight' => 10,
  );
  $items['admin/demo/disable'] = array(
    'title' => 'Manage demo',
    'description' => 'todo.',
    'page callback' => 'demo_disable_me',
    'access callback' => TRUE,
    //'access callback' => 'commerce_product_ui_product_add_any_access',
    'weight' => 10,
  );
  return $items;
}

/**
 * Menu callback.
 */
function demo_kill_me_form() {
  $form['message'] = array(
    '#type' => 'item',
    '#markup' => 'Warning : Your are going to wipe all content from this site',
  );
  $form['buttons']['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Kill me !'),
  );
  return $form;
}

/**
 * Submit function for .
 *
 * @param $form
 * @param $form_state
 */
function  demo_kill_me_form_submit($form, &$form_state) {
  global $databases, $db_url;
  $database = $databases['default']['default'];
  $tables = db_find_tables('%');

  foreach($tables as $table) {
    db_drop_table($table);
  }
  include_once DRUPAL_ROOT . '/includes/install.inc';
  install_goto('install.php?profile=commerce_kickstart&locale=en');

}


/**
 * Disable demo module.
 */
function  demo_disable_me() {
  module_disable(array('demo'));
  variable_set('menu_rebuild_needed', TRUE);
}

/**
 * Implements hook_page_alter().
 */
function demo_page_alter(&$page) {
  global $base_url;
  $message = 'You are in commerce kickstart demo mode';
  $url = '/admin/demo';
  $icon_path = $base_url . '/' . drupal_get_path('module', 'demo') . '/images/';
  drupal_add_js(array('demo' => array('message' => filter_xss_admin($message), 'icons_path' => $icon_path, 'url' => $url)), 'setting');
  drupal_add_js(drupal_get_path('module', 'demo') . '/demo.js');
}

